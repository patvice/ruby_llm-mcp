<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/images/favicon/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Tools | RubyLLM::MCP</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Tools" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Working with MCP tools - discovery, execution, human-in-the-loop, and streaming" /> <meta property="og:description" content="Working with MCP tools - discovery, execution, human-in-the-loop, and streaming" /> <link rel="canonical" href="http://localhost:4000/server/tools.html" /> <meta property="og:url" content="http://localhost:4000/server/tools.html" /> <meta property="og:site_name" content="RubyLLM::MCP" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Tools" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Working with MCP tools - discovery, execution, human-in-the-loop, and streaming","headline":"Tools","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/rubyllm-mcp-logo-text.svg"}},"url":"http://localhost:4000/server/tools.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="RubyLLM::MCP"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/configuration.html" class="nav-list-link">Configuration</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Guides category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/guides/" class="nav-list-link">Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/guides/getting-started.html" class="nav-list-link">Basics</a></li><li class="nav-list-item"><a href="/guides/rails-integration.html" class="nav-list-link">Rails Integration</a></li><li class="nav-list-item"><a href="/guides/transports.html" class="nav-list-link">Transports</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Server Interactions category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/server/" class="nav-list-link">Server Interactions</a><ul class="nav-list"><li class="nav-list-item"><a href="/server/tools.html" class="nav-list-link">Tools</a></li><li class="nav-list-item"><a href="/server/resources.html" class="nav-list-link">Resources</a></li><li class="nav-list-item"><a href="/server/prompts.html" class="nav-list-link">Prompts</a></li><li class="nav-list-item"><a href="/server/notifications.html" class="nav-list-link">Notifications</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Client Interactions category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/client/" class="nav-list-link">Client Interactions</a><ul class="nav-list"><li class="nav-list-item"><a href="/client/sampling.html" class="nav-list-link">Sampling</a></li><li class="nav-list-item"><a href="/client/roots.html" class="nav-list-link">Roots</a></li></ul></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/patvice/ruby_llm-mcp" class="nav-list-link external" > Github <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search RubyLLM::MCP" aria-label="Search RubyLLM::MCP" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/server/">Server Interactions</a></li> <li class="breadcrumb-nav-list-item"><span>Tools</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="tools"> <a href="#tools" class="anchor-heading" aria-labelledby="tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tools </h1> <p>MCP tools are server-side operations that can be executed by LLMs to perform actions like reading files, making API calls, or running calculations. This guide covers everything you need to know about working with MCP tools.</p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#tool-discovery" id="markdown-toc-tool-discovery">Tool Discovery</a> <ol> <li><a href="#listing-available-tools" id="markdown-toc-listing-available-tools">Listing Available Tools</a></li> <li><a href="#getting-a-specific-tool" id="markdown-toc-getting-a-specific-tool">Getting a Specific Tool</a></li> <li><a href="#refreshing-tool-cache" id="markdown-toc-refreshing-tool-cache">Refreshing Tool Cache</a></li> </ol> </li> <li><a href="#tool-execution" id="markdown-toc-tool-execution">Tool Execution</a> <ol> <li><a href="#direct-tool-execution" id="markdown-toc-direct-tool-execution">Direct Tool Execution</a></li> <li><a href="#using-tools-with-rubyllm" id="markdown-toc-using-tools-with-rubyllm">Using Tools with RubyLLM</a></li> <li><a href="#individual-tool-usage" id="markdown-toc-individual-tool-usage">Individual Tool Usage</a></li> </ol> </li> <li><a href="#human-in-the-loop" id="markdown-toc-human-in-the-loop">Human-in-the-Loop</a> <ol> <li><a href="#basic-human-in-the-loop" id="markdown-toc-basic-human-in-the-loop">Basic Human-in-the-Loop</a></li> <li><a href="#conditional-human-in-the-loop" id="markdown-toc-conditional-human-in-the-loop">Conditional Human-in-the-Loop</a></li> <li><a href="#programmatic-guards" id="markdown-toc-programmatic-guards">Programmatic Guards</a></li> </ol> </li> <li><a href="#streaming-responses" id="markdown-toc-streaming-responses">Streaming Responses</a></li> <li><a href="#complex-parameters" id="markdown-toc-complex-parameters">Complex Parameters</a></li> <li><a href="#error-handling" id="markdown-toc-error-handling">Error Handling</a> <ol> <li><a href="#tool-execution-errors" id="markdown-toc-tool-execution-errors">Tool Execution Errors</a></li> <li><a href="#tool-not-found" id="markdown-toc-tool-not-found">Tool Not Found</a></li> <li><a href="#timeout-errors" id="markdown-toc-timeout-errors">Timeout Errors</a></li> </ol> </li> <li><a href="#tool-inspection" id="markdown-toc-tool-inspection">Tool Inspection</a> <ol> <li><a href="#understanding-tool-schema" id="markdown-toc-understanding-tool-schema">Understanding Tool Schema</a></li> <li><a href="#tool-capabilities" id="markdown-toc-tool-capabilities">Tool Capabilities</a></li> </ol> </li> <li><a href="#advanced-tool-usage" id="markdown-toc-advanced-tool-usage">Advanced Tool Usage</a> <ol> <li><a href="#tool-result-processing" id="markdown-toc-tool-result-processing">Tool Result Processing</a></li> <li><a href="#chaining-tool-calls" id="markdown-toc-chaining-tool-calls">Chaining Tool Calls</a></li> <li><a href="#tool-composition" id="markdown-toc-tool-composition">Tool Composition</a></li> </ol> </li> <li><a href="#performance-considerations" id="markdown-toc-performance-considerations">Performance Considerations</a> <ol> <li><a href="#tool-caching" id="markdown-toc-tool-caching">Tool Caching</a></li> <li><a href="#batch-operations" id="markdown-toc-batch-operations">Batch Operations</a></li> </ol> </li> <li><a href="#next-steps" id="markdown-toc-next-steps">Next Steps</a></li> </ol><hr /> <h2 id="tool-discovery"> <a href="#tool-discovery" class="anchor-heading" aria-labelledby="tool-discovery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Discovery </h2> <h3 id="listing-available-tools"> <a href="#listing-available-tools" class="anchor-heading" aria-labelledby="listing-available-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Listing Available Tools </h3> <p>Get all tools from an MCP server:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">MCP</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"filesystem"</span><span class="p">,</span>
  <span class="ss">transport_type: :stdio</span><span class="p">,</span>
  <span class="ss">config: </span><span class="p">{</span>
    <span class="ss">command: </span><span class="s2">"npx"</span><span class="p">,</span>
    <span class="ss">args: </span><span class="p">[</span><span class="s2">"@modelcontextprotocol/server-filesystem"</span><span class="p">,</span> <span class="s2">"/path/to/directory"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Get all available tools</span>
<span class="n">tools</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tools</span>
<span class="nb">puts</span> <span class="s2">"Available tools:"</span>
<span class="n">tools</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tool</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"- </span><span class="si">#{</span><span class="n">tool</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">tool</span><span class="p">.</span><span class="nf">description</span><span class="si">}</span><span class="s2">"</span>

  <span class="c1"># Show input schema</span>
  <span class="n">tool</span><span class="p">.</span><span class="nf">input_schema</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">]</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">param</span><span class="p">,</span> <span class="n">schema</span><span class="o">|</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">tool</span><span class="p">.</span><span class="nf">input_schema</span><span class="p">[</span><span class="s2">"required"</span><span class="p">]</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="p">?</span> <span class="s2">" (required)"</span> <span class="p">:</span> <span class="s2">""</span>
    <span class="nb">puts</span> <span class="s2">"  - </span><span class="si">#{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">schema</span><span class="p">[</span><span class="s1">'description'</span><span class="p">]</span><span class="si">}#{</span><span class="n">required</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="getting-a-specific-tool"> <a href="#getting-a-specific-tool" class="anchor-heading" aria-labelledby="getting-a-specific-tool"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting a Specific Tool </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get a specific tool by name</span>
<span class="n">file_tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"read_file"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">"Tool: </span><span class="si">#{</span><span class="n">file_tool</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"Description: </span><span class="si">#{</span><span class="n">file_tool</span><span class="p">.</span><span class="nf">description</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"Input schema: </span><span class="si">#{</span><span class="n">file_tool</span><span class="p">.</span><span class="nf">input_schema</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div> <h3 id="refreshing-tool-cache"> <a href="#refreshing-tool-cache" class="anchor-heading" aria-labelledby="refreshing-tool-cache"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refreshing Tool Cache </h3> <p>Tools are cached to improve performance. Refresh when needed:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Refresh all tools</span>
<span class="n">tools</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tools</span><span class="p">(</span><span class="ss">refresh: </span><span class="kp">true</span><span class="p">)</span>

<span class="c1"># Refresh a specific tool</span>
<span class="n">tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"read_file"</span><span class="p">,</span> <span class="ss">refresh: </span><span class="kp">true</span><span class="p">)</span>
</code></pre></div></div> <h2 id="tool-execution"> <a href="#tool-execution" class="anchor-heading" aria-labelledby="tool-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Execution </h2> <h3 id="direct-tool-execution"> <a href="#direct-tool-execution" class="anchor-heading" aria-labelledby="direct-tool-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Direct Tool Execution </h3> <p>Execute tools directly without using LLM:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Execute a file reading tool</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"read_file"</span><span class="p">,</span>
  <span class="ss">parameters: </span><span class="p">{</span>
    <span class="ss">path: </span><span class="s2">"README.md"</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="nb">puts</span> <span class="s2">"File contents: </span><span class="si">#{</span><span class="n">result</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div> <h3 id="using-tools-with-rubyllm"> <a href="#using-tools-with-rubyllm" class="anchor-heading" aria-labelledby="using-tools-with-rubyllm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using Tools with RubyLLM </h3> <p>Integrate tools into LLM conversations:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add all tools to a chat</span>
<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s2">"gpt-4"</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="o">*</span><span class="n">client</span><span class="p">.</span><span class="nf">tools</span><span class="p">)</span>

<span class="c1"># Ask the LLM to use tools</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Read the README.md file and summarize it"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">response</span>
</code></pre></div></div> <h3 id="individual-tool-usage"> <a href="#individual-tool-usage" class="anchor-heading" aria-labelledby="individual-tool-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Individual Tool Usage </h3> <p>Use specific tools in conversations:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get a specific tool</span>
<span class="n">search_tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"search_files"</span><span class="p">)</span>

<span class="c1"># Add only this tool to the chat</span>
<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s2">"gpt-4"</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="n">search_tool</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Search for all Ruby files in the project"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">response</span>
</code></pre></div></div> <h2 id="human-in-the-loop"> <a href="#human-in-the-loop" class="anchor-heading" aria-labelledby="human-in-the-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Human-in-the-Loop </h2> <p>Control tool execution with human approval:</p> <h3 id="basic-human-in-the-loop"> <a href="#basic-human-in-the-loop" class="anchor-heading" aria-labelledby="basic-human-in-the-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Human-in-the-Loop </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set up human approval for all tools</span>
<span class="n">client</span><span class="p">.</span><span class="nf">on_human_in_the_loop</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">params</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Tool: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"Parameters: </span><span class="si">#{</span><span class="n">params</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">print</span> <span class="s2">"Allow execution? (y/n): "</span>
  <span class="nb">gets</span><span class="p">.</span><span class="nf">chomp</span><span class="p">.</span><span class="nf">downcase</span> <span class="o">==</span> <span class="s1">'y'</span>
<span class="k">end</span>

<span class="c1"># Execute tool (will prompt for approval)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"delete_file"</span><span class="p">,</span>
  <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">path: </span><span class="s2">"important.txt"</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <h3 id="conditional-human-in-the-loop"> <a href="#conditional-human-in-the-loop" class="anchor-heading" aria-labelledby="conditional-human-in-the-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conditional Human-in-the-Loop </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Only require approval for dangerous operations</span>
<span class="n">client</span><span class="p">.</span><span class="nf">on_human_in_the_loop</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">params</span><span class="o">|</span>
  <span class="n">dangerous_tools</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"delete_file"</span><span class="p">,</span> <span class="s2">"modify_file"</span><span class="p">,</span> <span class="s2">"execute_command"</span><span class="p">]</span>

  <span class="k">if</span> <span class="n">dangerous_tools</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"‚ö†Ô∏è  Dangerous operation requested!"</span>
    <span class="nb">puts</span> <span class="s2">"Tool: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"Parameters: </span><span class="si">#{</span><span class="n">params</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">print</span> <span class="s2">"Allow execution? (y/n): "</span>
    <span class="nb">gets</span><span class="p">.</span><span class="nf">chomp</span><span class="p">.</span><span class="nf">downcase</span> <span class="o">==</span> <span class="s1">'y'</span>
  <span class="k">else</span>
    <span class="kp">true</span>  <span class="c1"># Allow safe operations automatically</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="programmatic-guards"> <a href="#programmatic-guards" class="anchor-heading" aria-labelledby="programmatic-guards"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Programmatic Guards </h3> <p>Use logic to determine approval:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">on_human_in_the_loop</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">params</span><span class="o">|</span>
  <span class="k">case</span> <span class="nb">name</span>
  <span class="k">when</span> <span class="s2">"delete_file"</span>
    <span class="c1"># Don't allow deletion of important files</span>
    <span class="o">!</span><span class="n">params</span><span class="p">[</span><span class="ss">:path</span><span class="p">].</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"important"</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"api_call"</span>
    <span class="c1"># Only allow API calls to trusted domains</span>
    <span class="n">params</span><span class="p">[</span><span class="ss">:url</span><span class="p">].</span><span class="nf">start_with?</span><span class="p">(</span><span class="s2">"https://api.trusted.com"</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="streaming-responses"> <a href="#streaming-responses" class="anchor-heading" aria-labelledby="streaming-responses"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Streaming Responses </h2> <p>Monitor tool execution in real-time:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s2">"gpt-4"</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="o">*</span><span class="n">client</span><span class="p">.</span><span class="nf">tools</span><span class="p">)</span>

<span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Analyze all files in the project"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">chunk</span><span class="p">.</span><span class="nf">tool_call?</span>
    <span class="n">chunk</span><span class="p">.</span><span class="nf">tool_calls</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">tool_call</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"üîß Using tool: </span><span class="si">#{</span><span class="n">tool_call</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span>
      <span class="nb">puts</span> <span class="s2">"   Parameters: </span><span class="si">#{</span><span class="n">tool_call</span><span class="p">.</span><span class="nf">parameters</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="nb">print</span> <span class="n">chunk</span><span class="p">.</span><span class="nf">content</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="complex-parameters"> <a href="#complex-parameters" class="anchor-heading" aria-labelledby="complex-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complex Parameters </h2> <p>Enable support for complex parameters like arrays and nested objects:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable complex parameter support globally</span>
<span class="no">RubyLLM</span><span class="o">::</span><span class="no">MCP</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">support_complex_parameters!</span>
<span class="k">end</span>

<span class="c1"># Use complex parameters in tools</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"process_data"</span><span class="p">,</span>
  <span class="ss">parameters: </span><span class="p">{</span>
    <span class="ss">items: </span><span class="p">[</span>
      <span class="p">{</span> <span class="ss">name: </span><span class="s2">"item1"</span><span class="p">,</span> <span class="ss">value: </span><span class="mi">100</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[</span><span class="s2">"important"</span><span class="p">,</span> <span class="s2">"urgent"</span><span class="p">]</span> <span class="p">},</span>
      <span class="p">{</span> <span class="ss">name: </span><span class="s2">"item2"</span><span class="p">,</span> <span class="ss">value: </span><span class="mi">200</span><span class="p">,</span> <span class="ss">tags: </span><span class="p">[</span><span class="s2">"normal"</span><span class="p">]</span> <span class="p">}</span>
    <span class="p">],</span>
    <span class="ss">options: </span><span class="p">{</span>
      <span class="ss">sort: </span><span class="p">{</span> <span class="ss">field: </span><span class="s2">"value"</span><span class="p">,</span> <span class="ss">order: </span><span class="s2">"desc"</span> <span class="p">},</span>
      <span class="ss">filter: </span><span class="p">{</span> <span class="ss">category: </span><span class="s2">"active"</span><span class="p">,</span> <span class="ss">min_value: </span><span class="mi">50</span> <span class="p">},</span>
      <span class="ss">pagination: </span><span class="p">{</span> <span class="ss">page: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">per_page: </span><span class="mi">10</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <h2 id="error-handling"> <a href="#error-handling" class="anchor-heading" aria-labelledby="error-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Handling </h2> <h3 id="tool-execution-errors"> <a href="#tool-execution-errors" class="anchor-heading" aria-labelledby="tool-execution-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Execution Errors </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"read_file"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">path: </span><span class="s2">"/nonexistent/file.txt"</span> <span class="p">}</span>
  <span class="p">)</span>
<span class="k">rescue</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">MCP</span><span class="o">::</span><span class="no">Errors</span><span class="o">::</span><span class="no">ToolError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"Tool execution failed: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"Error details: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">error_details</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="tool-not-found"> <a href="#tool-not-found" class="anchor-heading" aria-labelledby="tool-not-found"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Not Found </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="n">tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"nonexistent_tool"</span><span class="p">)</span>
<span class="k">rescue</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">MCP</span><span class="o">::</span><span class="no">Errors</span><span class="o">::</span><span class="no">ToolNotFound</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"Tool not found: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="timeout-errors"> <a href="#timeout-errors" class="anchor-heading" aria-labelledby="timeout-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Timeout Errors </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"slow_operation"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">size: </span><span class="s2">"large"</span> <span class="p">}</span>
  <span class="p">)</span>
<span class="k">rescue</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">MCP</span><span class="o">::</span><span class="no">Errors</span><span class="o">::</span><span class="no">TimeoutError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"Tool execution timed out: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="tool-inspection"> <a href="#tool-inspection" class="anchor-heading" aria-labelledby="tool-inspection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Inspection </h2> <h3 id="understanding-tool-schema"> <a href="#understanding-tool-schema" class="anchor-heading" aria-labelledby="understanding-tool-schema"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding Tool Schema </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"create_file"</span><span class="p">)</span>

<span class="c1"># Basic information</span>
<span class="nb">puts</span> <span class="s2">"Name: </span><span class="si">#{</span><span class="n">tool</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"Description: </span><span class="si">#{</span><span class="n">tool</span><span class="p">.</span><span class="nf">description</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Input schema details</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">tool</span><span class="p">.</span><span class="nf">input_schema</span>
<span class="nb">puts</span> <span class="s2">"Required parameters: </span><span class="si">#{</span><span class="n">schema</span><span class="p">[</span><span class="s1">'required'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>

<span class="n">schema</span><span class="p">[</span><span class="s1">'properties'</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">param</span><span class="p">,</span> <span class="n">details</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Parameter: </span><span class="si">#{</span><span class="n">param</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"  Type: </span><span class="si">#{</span><span class="n">details</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"  Description: </span><span class="si">#{</span><span class="n">details</span><span class="p">[</span><span class="s1">'description'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"  Required: </span><span class="si">#{</span><span class="n">schema</span><span class="p">[</span><span class="s1">'required'</span><span class="p">]</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="tool-capabilities"> <a href="#tool-capabilities" class="anchor-heading" aria-labelledby="tool-capabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Capabilities </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Check if tool supports specific features</span>
<span class="n">tool</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">tool</span><span class="p">(</span><span class="s2">"search_files"</span><span class="p">)</span>

<span class="c1"># Check parameter types</span>
<span class="k">if</span> <span class="n">tool</span><span class="p">.</span><span class="nf">input_schema</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">][</span><span class="s2">"pattern"</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"Supports pattern matching"</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">tool</span><span class="p">.</span><span class="nf">input_schema</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">][</span><span class="s2">"recursive"</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"Supports recursive search"</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="advanced-tool-usage"> <a href="#advanced-tool-usage" class="anchor-heading" aria-labelledby="advanced-tool-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Tool Usage </h2> <h3 id="tool-result-processing"> <a href="#tool-result-processing" class="anchor-heading" aria-labelledby="tool-result-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Result Processing </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Process tool results</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"list_files"</span><span class="p">,</span>
  <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">directory: </span><span class="s2">"/path/to/search"</span> <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Parse JSON results</span>
<span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">String</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s2">"{"</span><span class="p">)</span>
  <span class="n">parsed</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Found </span><span class="si">#{</span><span class="n">parsed</span><span class="p">[</span><span class="s1">'files'</span><span class="p">].</span><span class="nf">length</span><span class="si">}</span><span class="s2"> files"</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="chaining-tool-calls"> <a href="#chaining-tool-calls" class="anchor-heading" aria-labelledby="chaining-tool-calls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Chaining Tool Calls </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First tool call</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"list_files"</span><span class="p">,</span>
  <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">directory: </span><span class="s2">"/project"</span> <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Use result in second tool call</span>
<span class="n">parsed_files</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="n">ruby_files</span> <span class="o">=</span> <span class="n">parsed_files</span><span class="p">[</span><span class="s2">"files"</span><span class="p">].</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="p">.</span><span class="nf">end_with?</span><span class="p">(</span><span class="s2">".rb"</span><span class="p">)</span> <span class="p">}</span>

<span class="n">ruby_files</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"read_file"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">path: </span><span class="n">file</span> <span class="p">}</span>
  <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"File: </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="n">content</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="tool-composition"> <a href="#tool-composition" class="anchor-heading" aria-labelledby="tool-composition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Composition </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a higher-level operation using multiple tools</span>
<span class="k">def</span> <span class="nf">analyze_project</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
  <span class="c1"># Get project structure</span>
  <span class="n">structure</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"list_files"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">directory: </span><span class="s2">"."</span><span class="p">,</span> <span class="ss">recursive: </span><span class="kp">true</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="c1"># Read important files</span>
  <span class="n">readme</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"read_file"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">path: </span><span class="s2">"README.md"</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="c1"># Search for specific patterns</span>
  <span class="n">todos</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"search_files"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">pattern: </span><span class="s2">"TODO"</span><span class="p">,</span> <span class="ss">directory: </span><span class="s2">"."</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="p">{</span>
    <span class="ss">structure: </span><span class="n">structure</span><span class="p">,</span>
    <span class="ss">readme: </span><span class="n">readme</span><span class="p">,</span>
    <span class="ss">todos: </span><span class="n">todos</span>
  <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Use in a chat</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_project</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s2">"gpt-4"</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="o">*</span><span class="n">client</span><span class="p">.</span><span class="nf">tools</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Based on this project analysis: </span><span class="si">#{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">, provide recommendations"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">response</span>
</code></pre></div></div> <h2 id="performance-considerations"> <a href="#performance-considerations" class="anchor-heading" aria-labelledby="performance-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Performance Considerations </h2> <h3 id="tool-caching"> <a href="#tool-caching" class="anchor-heading" aria-labelledby="tool-caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Caching </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Cache expensive tool results</span>
<span class="k">class</span> <span class="nc">ToolCache</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    <span class="vi">@client</span> <span class="o">=</span> <span class="n">client</span>
    <span class="vi">@cache</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">execute_tool</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">parameters</span><span class="p">.</span><span class="nf">hash</span><span class="si">}</span><span class="s2">"</span>

    <span class="vi">@cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">||=</span> <span class="vi">@client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
      <span class="ss">name: </span><span class="nb">name</span><span class="p">,</span>
      <span class="ss">parameters: </span><span class="n">parameters</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">cached_client</span> <span class="o">=</span> <span class="no">ToolCache</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div> <h3 id="batch-operations"> <a href="#batch-operations" class="anchor-heading" aria-labelledby="batch-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch Operations </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Process multiple files efficiently</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"file1.txt"</span><span class="p">,</span> <span class="s2">"file2.txt"</span><span class="p">,</span> <span class="s2">"file3.txt"</span><span class="p">]</span>
<span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">files</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">contents</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">execute_tool</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"read_file"</span><span class="p">,</span>
    <span class="ss">parameters: </span><span class="p">{</span> <span class="ss">path: </span><span class="n">file</span> <span class="p">}</span>
  <span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Use all contents in a single chat</span>
<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s2">"gpt-4"</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="o">*</span><span class="n">client</span><span class="p">.</span><span class="nf">tools</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Analyze these files: </span><span class="si">#{</span><span class="n">contents</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">response</span>
</code></pre></div></div> <h2 id="next-steps"> <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps </h2> <ul> <li><strong><a href="/server/resources.html">Resources</a></strong> - Working with MCP resources</li> <li><strong><a href="/server/prompts.html">Prompts</a></strong> - Using predefined prompts</li> <li><strong><a href="/server/notifications.html">Notifications</a></strong> - Handling real-time updates</li> </ul> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2025 <a href='https://patrickvice.com'>Patrick Vice</a>. Distributed under an <a href="https://github.com/patvice/ruby_llm-mcp/tree/main/LICENSE">MIT license.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
